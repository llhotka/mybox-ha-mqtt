* Sensors and scripts

This section contains definitions of sensors and services based on MQTT topics supported by the wallbox.

** AC module

*** EVSE state

Possible values are ~Unplugged~, ~Plugged~, ~Charging~ and ~Paused~.

#+NAME: sensor.mybox_evse_state
#+begin_src yaml
  - name: "MyBox EVSE state"
    icon: "mdi:ev-station"
    unique_id: "305537af-ce8e-4a9d-9edd-dee4aec55212"
    state_topic: >-
      charger/e5qb-ekgg-48wz-o07w/ac-module-1-ac-module/evse-state
#+end_src

*** Car state

| Value   | Meaning                       |
|---------+-------------------------------|
| STATE A | EV not connected              |
| STATE B | EV connected but not charging |
| STATE C | EV connected and charging     |

#+NAME: sensor.mybox_car_state
#+begin_src yaml
  - name: "MyBox car state"
    icon: "mdi:car-electric"
    unique_id: "cda4fae0-10f5-4dbe-a7e5-ef6a331d3129"
    state_topic: >-
      charger/e5qb-ekgg-48wz-o07w/ac-module-1-ac-module/car-state
#+end_src

*** Maximum charge current

#+NAME: sensor.mybox_max_charge_current
#+begin_src yaml
  - name: "MyBox max charge current"
    icon: "mdi:current-ac"
    unique_id: "e7446234-e557-4135-9117-3b9b6db3c0df"
    unit_of_measurement: "A"
    state_class: measurement
    state_topic: >-
      charger/e5qb-ekgg-48wz-o07w/ac-module-1-ac-module/max-charge-current
#+end_src

This script sets the value of the maximum charge current

#+NAME: script.set_mybox_max_charge_current
#+begin_src yaml
  set_mybox_max_charge_current:
    alias: "Nastav maximální nabíjecí proud"
    description: >-
      Nastav maximální nabíjecí proud pro MyBox.
    icon: "mdi:current-ac"
    fields:
      value:
        name: "Max charge current value"
        selector:
          number:
            min: 6
            max: 16
            step: 1
            unit_of_measurement: "A"
            mode: slider
    sequence:
      - action: mqtt.publish
        data:
          topic: >-
            charger/e5qb-ekgg-48wz-o07w/ac-module-1-ac-module/max-charge-current/set
          payload_template: "{{ value }}"
#+end_src

*** Cable locked?

#+NAME: sensor.mybox_cable_locked
#+begin_src yaml
  - name: "MyBox cable locked"
    icon: "mdi:ev-plug-type2"
    unique_id: "f010644a-8e6f-4811-94b1-7a75fa05f7d2"
    state_topic: >-
      charger/e5qb-ekgg-48wz-o07w/ac-module-1-ac-module/cable-locked
    payload_on: "true"
    payload_off: "false"
#+end_src

** EV meter

#+NAME: sensor.mybox_meter_power
#+begin_src yaml
  - name: "MyBox meter power"
    icon: "mdi:ev-station"
    unique_id: "57e6e10e-b62d-4507-9982-0fd6dd5a139a"
    unit_of_measurement: "kW"
    state_class: measurement
    state_topic: >-
      charger/e5qb-ekgg-48wz-o07w/ac-module-1-ev-meter/ev-meter-power
#+end_src

#+NAME: sensor.mybox_meter_energy
#+begin_src yaml
  - name: "MyBox EV meter energy"
    icon: "mdi:ev-station"
    object_id: "mybox_meter_energy"
    unique_id: "ff4fd070-5f35-4a67-896d-b0b73fdb06ed"
    unit_of_measurement: "kWh"
    state_class: total_increasing
    state_topic: >-
      charger/e5qb-ekgg-48wz-o07w/ac-module-1-ev-meter/ev-meter-energy
#+end_src

#+begin_src yaml :tangle customizations.yaml
  sensor.mybox_meter_energy:
    device_class: energy
#+end_src

* Control

** Pause charging

#+NAME: script.mybox_pause_charging
#+begin_src yaml
  mybox_pause_charging:
    alias: "Pozastav nabíjení"
    description: >-
      Pozastav nabíjení EV z MyBoxu.
    mode: single
    sequence:
      - action: mqtt.publish
        data:
          topic: >-
            charger/e5qb-ekgg-48wz-o07w/ac-module-1-ac-module/pause-charging/set
#+end_src

** Resume charging

#+NAME: script.mybox_resume_charging
#+begin_src yaml
  mybox_resume_charging:
    alias: "Obnov nabíjení"
    description: >-
      Obnov nabíjení EV z MyBoxu.
    mode: single
    sequence:
      - action: mqtt.publish
        data:
          topic: >-
            charger/e5qb-ekgg-48wz-o07w/ac-module-1-ac-module/resume-charging/set
#+end_src

** Stop charging

#+NAME: script.mybox_stop_charging
#+begin_src yaml
  mybox_stop_charging:
    alias: "Ukonči nabíjení"
    description: >-
      Ukonči nabíjení EV z MyBoxu.
    mode: single
    sequence:
      - action: mqtt.publish
        data:
          topic: >-
            charger/e5qb-ekgg-48wz-o07w/ac-module-1-ac-module/stop-charging/set
#+end_src

